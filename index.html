<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØveApp – Januar 2026</title>
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background:#f9fafb; margin:0; padding:12px; }
h1 { text-align:center; margin-bottom:12px; }
button { cursor:pointer; }
#totalBar { background:#e5e7eb; border-radius:14px; overflow:hidden; margin-top:12px; }
#totalFill { background:linear-gradient(90deg,#4ade80,#22c55e); color:#064e3b; font-weight:700; padding:10px; width:0%; text-align:center; transition:0.3s; position:fixed; bottom:0; left:0; right:0; }
#calendar { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:14px; margin-top:12px; }
.day { background:white; border-radius:14px; padding:14px; box-shadow:0 6px 16px rgba(0,0,0,0.08); }
.day-title { font-weight:700; margin-bottom:6px; }
.day-note { font-size:13px; color:#6b7280; font-style:italic; margin-bottom:6px; }
.session { background:#e0e7ff; border:none; border-radius:10px; padding:8px; width:100%; text-align:left; margin-bottom:6px; font-weight:500; }
.session.done { background:#dcfce7; text-decoration:line-through; color:#065f46; }
canvas { margin-top:24px; background:white; border-radius:14px; padding:14px; }
#materialDropdownContainer {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; border-radius:12px; padding:16px; box-shadow:0 6px 16px rgba(0,0,0,0.2); z-index:1000;}
#materialDropdownContainer input {margin-top:8px; width:100%; padding:6px;}
#materialDropdownContainer button {margin-top:8px; width:48%; margin-right:4%;}
#materialDropdownContainer button:last-child {margin-right:0;}
#startScreen {text-align:center;}
#startScreen button {margin:8px; padding:12px 20px; font-weight:700; border-radius:12px; background:#2563eb; color:white; border:none;}
</style>
</head>
<body>

<div id="startScreen">
<h1>ØveApp</h1>
<button onclick="startMonth('januar')">Januar 2026</button>
<button onclick="showMaterialScreen()">Øve Materiale</button>
</div>

<div id="calendarScreen" style="display:none;">
<h1 id="monthTitle">Januar 2026</h1>
<div id="calendar"></div>
<canvas id="progressChart" height="220"></canvas>
<div id="totalBar"><div id="totalFill">0 timer</div></div>
</div>

<!-- Materiale dropdown -->
<div id="materialDropdownContainer">
<label for="materialSelect">Vælg materiale:</label>
<select id="materialSelect"></select>
<input type="text" id="newMaterialInput" placeholder="Eller skriv nyt materiale"/>
<button id="confirmMaterial">Bekræft</button>
<button id="cancelMaterial">Annuller</button>
</div>

<script>
// ---------------- DATA ----------------
const instruments = ["Orgel","Trommer","Klaver"];
const schedule = {
"2026-01-01":{note:"",sessions:[["7–8","Orgel"],["11–12","Trommer"],["11:30–12:30","Trommer"],["13–14","Klaver"]]},
"2026-01-02":{note:"",sessions:[["7–8","Orgel"],["9–10","Trommer"],["10:30–11:30","Trommer"],["12–13","Trommer"],["14–15","Klaver"]]},
"2026-01-03":{note:"",sessions:[["7–8","Orgel"],["9–10","Trommer"],["10:30–11:30","Trommer"],["12:30–13:30","Klaver"],["14–15","Klaver"]]},
"2026-01-04":{note:"",sessions:[["7–8","Orgel"],["9–10","Trommer"],["10:30–11:30","Trommer"],["12–13","Trommer"],["14–15","Klaver"]]},
"2026-01-05":{note:"Orgelundervisning kl. 12",sessions:[["7–8","Orgel"],["13–14","Klaver"],["14:30–15:30","Klaver"]]},
// ... Fortsæt med alle dage i Januar ...
};

// ---------------- STATE ----------------
let done = JSON.parse(localStorage.getItem("done") || "{}");
let materialHistory = JSON.parse(localStorage.getItem("materialHistory") || "{}");

// ---------------- FUNCTIONS ----------------
function save(){ localStorage.setItem("done",JSON.stringify(done)); }
function saveMaterials(){ localStorage.setItem("materialHistory",JSON.stringify(materialHistory)); }

function totalHours(){
  return Object.values(done).filter(v=>v.done).length;
}

function updateTotal(){
  const t = totalHours();
  const bar = document.getElementById("totalFill");
  bar.textContent = t + " timer";
  bar.style.width = Math.min(t*4,100)+"%";
}

// Start måned
function startMonth(month){
  document.getElementById("startScreen").style.display="none";
  document.getElementById("calendarScreen").style.display="block";
  renderMonth();
}

// Øve materiale skærm
function showMaterialScreen(){
  alert("Her kan du se dine øve materialer og timer (kan bygges videre med liste/graf).");
}

// ---------------- RENDER ----------------
function renderMonth(){
  const cal = document.getElementById("calendar");
  cal.innerHTML="";
  Object.keys(schedule).forEach(date=>{
    const d = schedule[date];
    const box = document.createElement("div");
    box.className="day";
    box.innerHTML=`<div class="day-title">${date}</div>`;
    if(d.note) box.innerHTML+=`<div class="day-note">${d.note}</div>`;

    d.sessions.forEach((s,i)=>{
      const id = date+"-"+i;
      const b = document.createElement("button");
      b.className="session"+(done[id]&&done[id].done?" done":"");
      b.textContent = `${s[0]} – ${s[1]}`;
      b.onclick = ()=>{
        showMaterialDropdown(id,date,s[1]);
      };
      box.appendChild(b);
    });
    cal.appendChild(box);
  });
  updateTotal();
  updateChart();
}

// Dropdown til materiale
function showMaterialDropdown(id,date,instrument){
  const container = document.getElementById("materialDropdownContainer");
  const select = document.getElementById("materialSelect");
  const input = document.getElementById("newMaterialInput");
  container.style.display="block";

  select.innerHTML="";
  Object.keys(materialHistory).forEach(m=>{
    const option = document.createElement("option");
    option.value=m; option.textContent=m;
    select.appendChild(option);
  });
  input.value="";

  document.getElementById("confirmMaterial").onclick = ()=>{
    let material = input.value || select.value;
    if(!material) return;
    done[id]={done:true, material:material};
    if(!materialHistory[material]) materialHistory[material]=[];
    materialHistory[material].push({date:date,hours:1});
    save(); saveMaterials();
    container.style.display="none";
    renderMonth();
  };
  document.getElementById("cancelMaterial").onclick = ()=>{
    container.style.display="none";
  };
}

// ---------------- CHART ----------------
let chart;
function updateChart(){
  const labels = Object.keys(schedule);
  const data = instruments.map(inst =>
    labels.map(d =>
      schedule[d].sessions.filter((_,i)=>done[d+"-"+i]&&done[d+"-"+i].done&&schedule[d].sessions[i][1]===inst).length
    )
  );
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("progressChart"),{
    type:"line",
    data:{
      labels,
      datasets: instruments.map((i,idx)=>({label:i,data:data[idx],tension:0.25}))
    },
    options:{scales:{y:{beginAtZero:true}}}
  });
}

// ---------------- INIT ----------------
</script>
</body>
</html>
