<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Min √òve-Log</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --orgel: #3b82f6;
  --trommer: #ef4444;
  --klaver: #10b981;
}

body {
  font-family: 'Inter', sans-serif;
  background: #f3f4f6;
  margin: 0;
  padding: 15px;
  color: #1f2937;
}

.container { max-width: 500px; margin: 0 auto; }

h1 { text-align: center; margin-bottom: 25px; font-weight: 700; }

/* De 3 store knapper */
.quick-log {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  margin-bottom: 25px;
}

.log-btn {
  border: none;
  border-radius: 16px;
  padding: 20px 10px;
  color: white;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.log-btn:active { transform: scale(0.95); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.bg-orgel { background: var(--orgel); }
.bg-trommer { background: var(--trommer); }
.bg-klaver { background: var(--klaver); }

/* Sektioner */
.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

h2 { font-size: 18px; margin-top: 0; margin-bottom: 15px; display: flex; justify-content: space-between; }

.history-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #f3f4f6;
}

.history-item:last-child { border-bottom: none; }

.badge {
  padding: 4px 10px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

/* Dialog */
#materialDialog {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  z-index: 100;
  backdrop-filter: blur(4px);
}
.dialog-box {
  background:white;
  max-width:300px;
  margin: 20vh auto;
  padding: 25px;
  border-radius: 24px;
  text-align: center;
}

input {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  border-radius: 12px;
  border: 1px solid #ddd;
  box-sizing: border-box;
}

.save-btn {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: #111827;
  color: white;
  font-weight: 600;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
  <h1>√òveApp</h1>

  <div class="quick-log">
    <button class="log-btn bg-orgel" onclick="openDialog('Orgel')">üéπ<br>Orgel</button>
    <button class="log-btn bg-trommer" onclick="openDialog('Trommer')">ü•Å<br>Trommer</button>
    <button class="log-btn bg-klaver" onclick="openDialog('Klaver')">üéπ<br>Klaver</button>
  </div>

  <div class="card">
    <h2>Aktivitet (Timer)</h2>
    <canvas id="progressChart" height="200"></canvas>
  </div>

  <div class="card">
    <h2>√òve-materiale</h2>
    <div id="materialContent"></div>
  </div>

  <div class="card">
    <h2>Seneste √∏vninger</h2>
    <div id="historyList"></div>
  </div>
</div>

<div id="materialDialog">
  <div class="dialog-box">
    <h3 id="dialogTitle" style="margin:0"></h3>
    <input type="text" id="materialInput" placeholder="Hvad har du √∏vet?">
    <button class="save-btn" onclick="saveLog()">Gem 1 time</button>
    <button onclick="closeDialog()" style="background:none; border:none; margin-top:10px; color:#6b7280; cursor:pointer;">Annuller</button>
  </div>
</div>

<script>
let logs = JSON.parse(localStorage.getItem("music_logs_final") || "[]");
let currentInstrument = "";

function save() {
    localStorage.setItem("music_logs_final", JSON.stringify(logs));
    updateUI();
}

function openDialog(inst) {
    currentInstrument = inst;
    document.getElementById("dialogTitle").innerText = inst;
    document.getElementById("materialInput").value = "";
    document.getElementById("materialDialog").style.display = "block";
    document.getElementById("materialInput").focus();
}

function closeDialog() {
    document.getElementById("materialDialog").style.display = "none";
}

function saveLog() {
    const mat = document.getElementById("materialInput").value.trim() || "Generel √∏vning";
    const entry = {
        id: Date.now(),
        date: new Date().toISOString().split('T')[0],
        displayDate: new Date().toLocaleDateString('da-DK', {day: 'numeric', month: 'short'}),
        instrument: currentInstrument,
        material: mat
    };
    logs.push(entry);
    save();
    closeDialog();
}

// Opdaterer alt p√• sk√¶rmen
function updateUI() {
    renderHistory();
    renderMaterials();
    updateChart();
}

function renderHistory() {
    const list = document.getElementById("historyList");
    list.innerHTML = "";
    // Vis kun de 5 seneste
    [...logs].reverse().slice(0, 5).forEach(l => {
        list.innerHTML += `
            <div class="history-item">
                <div>
                    <strong>${l.displayDate}</strong><br>
                    <span style="font-size:12px; color:#6b7280">${l.material}</span>
                </div>
                <span class="badge" style="background:${getInstColor(l.instrument)}20; color:${getInstColor(l.instrument)}">
                    ${l.instrument}
                </span>
            </div>
        `;
    });
}

function renderMaterials() {
    const container = document.getElementById("materialContent");
    container.innerHTML = "";
    
    ["Orgel", "Trommer", "Klaver"].forEach(inst => {
        const instLogs = logs.filter(l => l.instrument === inst);
        if(instLogs.length === 0) return;

        const uniqueMaterials = [...new Set(instLogs.map(l => l.material))];
        let html = `<div style="margin-bottom:15px;">
                      <strong style="color:${getInstColor(inst)}">${inst}:</strong> 
                      <span style="font-size:13px; color:#4b5563;">${uniqueMaterials.join(", ")}</span>
                    </div>`;
        container.innerHTML += html;
    });
}

function getInstColor(inst) {
    if(inst === "Orgel") return "#3b82f6";
    if(inst === "Trommer") return "#ef4444";
    return "#10b981";
}

let chart;
function updateChart() {
    // Vi viser de sidste 7 dage p√• grafen for at g√∏re den l√¶selig
    const days = [];
    for(let i=6; i>=0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        days.push(d.toISOString().split('T')[0]);
    }

    const labels = days.map(d => new Date(d).toLocaleDateString('da-DK', {weekday: 'short'}));
    
    const datasets = ["Orgel", "Trommer", "Klaver"].map(inst => ({
        label: inst,
        data: days.map(d => logs.filter(l => l.date === d && l.instrument === inst).length),
        backgroundColor: getInstColor(inst),
        borderRadius: 5
    }));

    if(chart) chart.destroy();
    chart = new Chart(document.getElementById("progressChart"), {
        type: 'bar',
        data: { labels, datasets },
        options: {
            responsive: true,
            scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true, ticks: {stepSize: 1} } },
            plugins: { legend: { display: false } }
        }
    });
}

// Start appen
updateUI();
</script>

</body>
</html>
