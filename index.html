<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Musik Logbog Pro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  /* Ny smart farvepalette */
  --orgel: #5e5ce6;     /* Indigo */
  --trommer: #ff375f;   /* Rose */
  --klaver: #32d74b;    /* Green */
  --teori: #bf5af2;     /* Purple */
  --bg: #f2f2f7;
  --card-bg: #ffffff;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 15px;
  color: #1c1c1e;
}

.container { max-width: 500px; margin: 0 auto; }

h1 { text-align: center; margin-bottom: 20px; font-weight: 800; letter-spacing: -1px; }

/* Instrument knapper med nye billeder */
.instrument-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-bottom: 25px;
}

.log-btn {
  border: none;
  border-radius: 24px;
  padding: 0 0 15px 0;
  color: white;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 8px 15px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
  overflow: hidden;
  text-align: center;
}

.log-btn img {
  width: 100%;
  height: 100px;
  object-fit: cover;
  margin-bottom: 10px;
  filter: brightness(0.9);
}

.log-btn:active { transform: scale(0.96); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.bg-orgel { background: var(--orgel); }
.bg-trommer { background: var(--trommer); }
.bg-klaver { background: var(--klaver); }
.bg-teori { background: var(--teori); }

.card {
  background: var(--card-bg);
  border-radius: 28px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.03);
}

.nav-btn {
  width: 100%;
  padding: 18px;
  border-radius: 20px;
  border: none;
  background: #1c1c1e;
  color: #fff;
  font-weight: 700;
  cursor: pointer;
  margin-bottom: 10px;
  transition: opacity 0.2s;
}

.nav-btn:active { opacity: 0.8; }

/* Dialog & Inputs */
#materialDialog {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  z-index: 100;
  backdrop-filter: blur(10px);
}
.dialog-box {
  background:white;
  max-width:320px;
  margin: 10vh auto;
  padding: 30px;
  border-radius: 32px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

select, input {
  width: 100%;
  padding: 14px;
  margin-bottom: 15px;
  border-radius: 14px;
  border: 1px solid #e5e5ea;
  background: #f2f2f7;
  font-family: inherit;
  font-size: 16px;
}

.time-selector {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 20px;
}

.time-btn {
  padding: 12px;
  border: 2px solid #e5e5ea;
  border-radius: 14px;
  background: none;
  cursor: pointer;
  font-weight: 700;
  transition: 0.2s;
}

.time-btn.active {
  border-color: #1c1c1e;
  background: #1c1c1e;
  color: white;
}

/* Materiale visning */
.history-detail {
    font-size: 13px;
    color: #8e8e93;
    margin-left: 0;
    list-style-type: none;
    padding: 0;
    margin-top: 5px;
}
.material-row {
    padding: 12px 0;
    border-bottom: 1px solid #f2f2f7;
}
</style>
</head>

<body>

<div id="main-screen" class="container">
  <h1>ØveApp</h1>

  <div class="instrument-grid">
    <button class="log-btn bg-orgel" onclick="openLog('Orgel')">
        <img src="https://images.unsplash.com/photo-1543431109-7917c15f1848?auto=format&fit=crop&w=300&q=80" alt="Orgel">
        Orgel
    </button>
    <button class="log-btn bg-trommer" onclick="openLog('Trommer')">
        <img src="https://images.unsplash.com/photo-1519892300165-cb5542fb47c7?auto=format&fit=crop&w=300&q=80" alt="Trommer">
        Trommer
    </button>
    <button class="log-btn bg-klaver" onclick="openLog('Klaver')">
        <img src="https://images.unsplash.com/photo-1520522118961-14ad20a0307c?auto=format&fit=crop&w=300&q=80" alt="Klaver">
        Klaver
    </button>
    <button class="log-btn bg-teori" onclick="openLog('Hørelære/teori')">
        <img src="https://images.unsplash.com/photo-1507838596058-a7628c734ad5?auto=format&fit=crop&w=300&q=80" alt="Teori">
        Hørelære
    </button>
  </div>

  <div class="card">
    <canvas id="progressChart" height="220"></canvas>
  </div>

  <button class="nav-btn" onclick="showScreen('material-screen')">Gå til Øve-materiale</button>
</div>

<div id="material-screen" class="container" style="display:none">
    <button class="nav-btn" style="background:#8e8e93" onclick="showScreen('main-screen')">⬅ Tilbage</button>
    <h1>Materiale</h1>
    <div id="materialContent"></div>
</div>

<div id="materialDialog">
  <div class="dialog-box">
    <h2 id="dialogTitle" style="margin-top:0; text-align:center;"></h2>
    
    <div class="time-selector">
        <button id="btn30" class="time-btn" onclick="setDuration(0.5)">30 min</button>
        <button id="btn60" class="time-btn active" onclick="setDuration(1)">1 time</button>
    </div>

    <select id="materialSelect" onchange="if(this.value) document.getElementById('materialInput').value = ''">
      <option value="">-- Tidligere materiale --</option>
    </select>
    
    <input type="text" id="materialInput" placeholder="Nyt materiale...">
    
    <button class="nav-btn" style="margin-top:10px" onclick="confirmLog()">Gem</button>
    <button onclick="closeDialog()" style="background:none; border:none; width:100%; margin-top:5px; color:#8e8e93; cursor:pointer; font-weight:600;">Fortryd</button>
  </div>
</div>

<script>
let logs = JSON.parse(localStorage.getItem("music_logs_v5") || "[]");
let currentInstrument = "";
let currentDuration = 1;

function save() {
    localStorage.setItem("music_logs_v5", JSON.stringify(logs));
    updateUI();
}

function showScreen(id) {
    document.getElementById('main-screen').style.display = (id === 'main-screen' ? 'block' : 'none');
    document.getElementById('material-screen').style.display = (id === 'material-screen' ? 'block' : 'none');
    if(id === 'material-screen') renderMaterials();
}

function setDuration(val) {
    currentDuration = val;
    document.getElementById('btn30').classList.toggle('active', val === 0.5);
    document.getElementById('btn60').classList.toggle('active', val === 1);
}

function openLog(inst) {
    currentInstrument = inst;
    setDuration(1);
    document.getElementById("dialogTitle").innerText = inst;
    document.getElementById("materialInput").value = "";
    
    const select = document.getElementById("materialSelect");
    select.innerHTML = '<option value="">-- Tidligere materiale --</option>';
    
    const existing = [...new Set(logs.filter(l => l.instrument === inst).map(l => l.material))];
    existing.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m; opt.textContent = m;
        select.appendChild(opt);
    });

    document.getElementById("materialDialog").style.display = "block";
}

function closeDialog() {
    document.getElementById("materialDialog").style.display = "none";
}

function confirmLog() {
    const sel = document.getElementById("materialSelect").value;
    const inp = document.getElementById("materialInput").value.trim();
    const finalMaterial = inp || sel || "Øvning";

    logs.push({
        date: new Date().toLocaleDateString('da-DK'),
        isoDate: new Date().toISOString().split('T')[0],
        instrument: currentInstrument,
        material: finalMaterial,
        hours: currentDuration
    });

    save();
    closeDialog();
}

function updateUI() {
    updateChart();
}

function renderMaterials() {
    const container = document.getElementById("materialContent");
    container.innerHTML = "";
    
    const insts = ["Orgel", "Trommer", "Klaver", "Hørelære/teori"];
    insts.forEach(inst => {
        const instLogs = logs.filter(l => l.instrument === inst);
        if(instLogs.length === 0) return;

        let html = `<div class="card">
                      <h3 style="color: var(--${getVarName(inst)}); margin-top:0; font-size:22px;">${inst}</h3>`;
        
        const summary = {};
        instLogs.forEach(l => {
            if(!summary[l.material]) summary[l.material] = { hours: 0, dates: [] };
            summary[l.material].hours += l.hours;
            summary[l.material].dates.push(`${l.date} (${l.hours === 0.5 ? '30m' : '1t'})`);
        });

        for (const [name, data] of Object.entries(summary)) {
            html += `<div class="material-row">
                        <div style="display:flex; justify-content:space-between; font-weight:700;">
                            <span>${name}</span>
                            <span>${data.hours}t</span>
                        </div>
                        <ul class="history-detail">
                            ${data.dates.map(d => `<li>• ${d}</li>`).join('')}
                        </ul>
                     </div>`;
        }
        html += `</div>`;
        container.innerHTML += html;
    });
}

function getVarName(inst) {
    if(inst.includes("Hørelære")) return "teori";
    return inst.toLowerCase();
}

function getInstColor(inst) {
    const colors = {
        "Orgel": "#5e5ce6",
        "Trommer": "#ff375f",
        "Klaver": "#32d74b",
        "Hørelære/teori": "#bf5af2"
    };
    return colors[inst] || "#000";
}

let chart;
function updateChart() {
    const days = [];
    for(let i=13; i>=0; i--) { // Viser de sidste 14 dage
        const d = new Date();
        d.setDate(d.getDate() - i);
        days.push(d.toISOString().split('T')[0]);
    }

    const labels = days.map(d => {
        const date = new Date(d);
        return date.toLocaleDateString('da-DK', {day: 'numeric', month: 'short'});
    });

    const datasets = ["Orgel", "Trommer", "Klaver", "Hørelære/teori"].map(inst => {
        const color = getInstColor(inst);
        return {
            label: inst,
            data: days.map(d => {
                return logs.filter(l => l.isoDate === d && l.instrument === inst)
                           .reduce((sum, current) => sum + current.hours, 0);
            }),
            borderColor: color,
            backgroundColor: color + "20", // Gennemsigtig baggrund til bølgen
            fill: true,
            tension: 0.4, // Dette skaber de bløde bølge-kurver
            pointRadius: 2
        };
    });

    if(chart) chart.destroy();
    chart = new Chart(document.getElementById("progressChart"), {
        type: 'line',
        data: { labels, datasets },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            scales: { 
                x: { grid: { display: false } },
                y: { beginAtZero: true, grid: { color: '#e5e5ea' } } 
            },
            plugins: { 
                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 6, font: {size: 11, weight: '600'} } }
            }
        }
    });
}

updateUI();
</script>

</body>
</html>
